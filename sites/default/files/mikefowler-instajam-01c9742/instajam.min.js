/**
 * Instajam
 * Â© 2012 Mike Fowler
 * Instajam may be freely distributed under the MIT license.
 */

(function(){var Instajam;var INSTAGRAM_API_BASE='https://api.instagram.com/v1';Instajam=window.Instajam=function(options){options=options||{};function _request(method,path,data,callback){var request;function getURL(){return path.indexOf("http")===0?path:INSTAGRAM_API_BASE+path;}
data=data||{};if(options.access_token){data.access_token=options.access_token;}
if(options.client_id){data.client_id=options.client_id;}
if(!data.client_id&&!data.access_token){return callback(new Error('Instajam requires either an access token or a client ID.'));}
switch(method){case"PUT":data._method="PUT";method="POST";break;case"DELETE":data._method="DELETE";method="POST";break;}
request=$.ajax({type:method,url:getURL(),dataType:'jsonp',data:data});request.done(function(data){if(data.meta.code==400){return callback(new Error('Endpoint "'+path+'": '+data.meta.error_message));}else{return callback(data);}});request.fail(function(request,status){return callback(new Error('The request failed with status "'+request.status+'"'));});}
this.user={self:function(callback){_request("GET","/users/self",null,function(result){if(typeof callback==="function")callback(result);});},feed:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/self/feed",options,function(result){if(typeof callback==="function")callback(result);});},liked:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/self/media/liked",options,function(result){if(typeof callback==="function")callback(result);});},get:function(user_id,callback){_request("GET","/users/"+user_id,null,function(result){if(typeof callback==="function")callback(result);});},getRecent:function(user_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/users/"+user_id+"/media/recent",options,function(result){if(typeof callback==="function")callback(result);});},search:function(term,options,callback){if(typeof options==="function"){callback=options;options={};}else{options=options||{};}
options.q=term;_request("GET","/users/search",options,function(result){if(typeof callback==="function")callback(result);});},lookup:function(username,callback){this.search(username,null,function(result){if(result.data&&result.data.length==1)result=result.data[0];if(typeof callback==="function")callback(result);});},follows:function(user_id,callback){_request("GET","/users/"+user_id+"/follows",null,function(result){if(typeof callback==="function")callback(result);});},following:function(user_id,callback){_request("GET","/users/"+user_id+"/followed-by",null,function(result){if(typeof callback==="function")callback(result);});},requests:function(callback){_request("GET","/users/self/requested-by",null,function(result){if(typeof callback==="function")callback(result);});},getRelationship:function(user_id,callback){_request("GET","/users/"+user_id+"/relationship",null,function(result){if(typeof callback==="function")callback(result);});}};this.media={get:function(media_id,callback){_request("GET","/media/"+media_id,null,function(result){if(typeof callback==="function")callback(result);});},search:function(options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
if(options.lat&&options.lng){_request("GET","/media/search",options,function(result){if(typeof callback==="function")callback(result);});}else{throw new Error('Endpoint "/media/search": "lat" and "lng" options are required.');}},popular:function(callback){_request("GET","/media/popular",null,function(result){if(typeof callback==="function")callback(result);});},comments:function(media_id,callback){_request("GET","/media/"+media_id+"/comments",null,function(result){if(typeof callback==="function")callback(result);});},likes:function(media_id,callback){_request("GET","/media/"+media_id+"/likes",null,function(result){if(typeof callback==="function")callback(result);});}};this.tag={meta:function(tag_name,callback){_request("GET","/tags/"+tag_name,null,function(result){if(typeof callback==="function")callback(result);});},get:function(tag_name,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/tags/"+tag_name+"/media/recent",options,function(result){if(typeof callback==="function")callback(result);});},search:function(search_term,callback){var options={};options.q=search_term||"";_request("GET","/tags/search",options,function(result){if(typeof callback==="function")callback(result);});}};this.location={meta:function(location_id,callback){_request("GET","/locations/"+location_id,null,function(result){if(typeof callback==="function")callback(result);});},get:function(location_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/locations/"+location_id+"/media/recent",options,function(result){if(typeof callback==="function")callback(result);});},search:function(options,callback){options=options||{};if((options.lat!==null&&options.lng!==null)||options.foursquare_v2_id!==null){_request("GET","/locations/search",options,function(result){if(typeof callback==="function")callback(result);});}else{throw new Error('Endpoint "/locations/search": Either "lat" and "lng", or "foursquare_v2_id" are required.');}}};this.geography={get:function(geo_id,options,callback){if(typeof options==="function"){callback=options;options=null;}else{options=options||{};}
_request("GET","/geographies/"+geo_id+"/media/recent",options,function(result){if(typeof callback==="function")callback(result);});}};this.nextPage=function(url,callback){_request("GET",url,null,function(result){if(typeof callback==="function")callback(result);});};};}).call(this);